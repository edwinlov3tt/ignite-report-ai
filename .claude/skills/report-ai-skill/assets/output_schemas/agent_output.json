{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Report AI Agent Output Schema",
  "description": "Schema for structured output from Report AI expert agents",
  "type": "object",
  "required": ["agent", "agentType", "insights", "recommendations"],
  "properties": {
    "agent": {
      "type": "string",
      "description": "Name of the agent that generated this output"
    },
    "agentType": {
      "type": "string",
      "enum": ["platform", "industry", "tactic", "orchestrator"],
      "description": "Type of expert agent"
    },
    "generatedAt": {
      "type": "string",
      "format": "date-time",
      "description": "Timestamp when this output was generated"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Overall confidence score for this analysis"
    },
    "insights": {
      "type": "array",
      "description": "List of insights discovered by the agent",
      "items": {
        "$ref": "#/definitions/Insight"
      }
    },
    "recommendations": {
      "type": "array",
      "description": "List of actionable recommendations",
      "items": {
        "$ref": "#/definitions/Recommendation"
      }
    },
    "warnings": {
      "type": "array",
      "description": "List of warnings or issues requiring attention",
      "items": {
        "$ref": "#/definitions/Warning"
      }
    },
    "metrics": {
      "type": "array",
      "description": "Key metrics analyzed with benchmark comparisons",
      "items": {
        "$ref": "#/definitions/MetricAnalysis"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata about the analysis",
      "properties": {
        "tokensUsed": {
          "type": "integer"
        },
        "modelUsed": {
          "type": "string"
        },
        "contextLoaded": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "dataRowsAnalyzed": {
          "type": "integer"
        }
      }
    }
  },
  "definitions": {
    "Insight": {
      "type": "object",
      "required": ["category", "observation", "evidence", "impact"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this insight"
        },
        "category": {
          "type": "string",
          "enum": [
            "performance",
            "efficiency",
            "opportunity",
            "risk",
            "trend",
            "anomaly",
            "benchmark_comparison"
          ],
          "description": "Category of insight"
        },
        "observation": {
          "type": "string",
          "description": "What was observed or discovered"
        },
        "evidence": {
          "type": "string",
          "description": "Specific data points supporting this observation"
        },
        "impact": {
          "type": "string",
          "description": "Business impact or significance"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Confidence in this specific insight"
        },
        "relatedMetrics": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Metrics related to this insight"
        }
      }
    },
    "Recommendation": {
      "type": "object",
      "required": ["action", "expectedImpact", "priority"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this recommendation"
        },
        "title": {
          "type": "string",
          "description": "Short title for the recommendation"
        },
        "action": {
          "type": "string",
          "description": "Specific action to take"
        },
        "expectedImpact": {
          "type": "string",
          "description": "Quantified expected outcome"
        },
        "priority": {
          "type": "string",
          "enum": ["high", "medium", "low"],
          "description": "Priority level"
        },
        "effort": {
          "type": "string",
          "enum": ["low", "medium", "high"],
          "description": "Implementation effort required"
        },
        "timeline": {
          "type": "string",
          "enum": ["immediate", "this_week", "this_month", "next_quarter"],
          "description": "Suggested implementation timeline"
        },
        "rationale": {
          "type": "string",
          "description": "Why this recommendation matters"
        },
        "relatedInsights": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "IDs of insights supporting this recommendation"
        },
        "metrics": {
          "type": "object",
          "properties": {
            "impactMetric": {
              "type": "string"
            },
            "currentValue": {
              "type": "number"
            },
            "targetValue": {
              "type": "number"
            },
            "improvementPercent": {
              "type": "number"
            }
          }
        }
      }
    },
    "Warning": {
      "type": "object",
      "required": ["severity", "message"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for this warning"
        },
        "severity": {
          "type": "string",
          "enum": ["critical", "warning", "info"],
          "description": "Severity level"
        },
        "message": {
          "type": "string",
          "description": "Warning message"
        },
        "metric": {
          "type": "string",
          "description": "Affected metric"
        },
        "threshold": {
          "type": "number",
          "description": "Threshold that was exceeded"
        },
        "actual": {
          "type": "number",
          "description": "Actual value"
        },
        "recommendedAction": {
          "type": "string",
          "description": "What to do about this warning"
        },
        "urgency": {
          "type": "string",
          "enum": ["immediate", "soon", "monitor"],
          "description": "How urgently action is needed"
        }
      }
    },
    "MetricAnalysis": {
      "type": "object",
      "required": ["metric", "actual", "benchmark", "status"],
      "properties": {
        "metric": {
          "type": "string",
          "description": "Metric name"
        },
        "actual": {
          "type": "number",
          "description": "Actual value"
        },
        "actualFormatted": {
          "type": "string",
          "description": "Formatted actual value with unit"
        },
        "benchmark": {
          "type": "number",
          "description": "Benchmark value"
        },
        "benchmarkFormatted": {
          "type": "string",
          "description": "Formatted benchmark value with unit"
        },
        "benchmarkSource": {
          "type": "string",
          "description": "Source of benchmark (e.g., 'Industry Q4 2024')"
        },
        "variance": {
          "type": "number",
          "description": "Percentage variance from benchmark"
        },
        "varianceFormatted": {
          "type": "string",
          "description": "Formatted variance (e.g., '+15%' or '-10%')"
        },
        "status": {
          "type": "string",
          "enum": ["excellent", "good", "average", "below_average", "poor"],
          "description": "Performance status"
        },
        "trend": {
          "type": "string",
          "enum": ["improving", "stable", "declining"],
          "description": "Trend direction if historical data available"
        },
        "percentile": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentile rank vs benchmark distribution"
        }
      }
    }
  }
}
